{% extends "/base.twig" %}
{% import "macros/utils.twig" as utils %}

{% block title %}Projet{% endblock %}
{% block subtitle %}
	<h2>{{ post.title }}</h2>
	<em>{{ post.frenchCreationDate }}</em><br>
	<a id="retour" href="/posts" ><i class="fa fa-arrow-left" aria-hidden="true"></i></a>
	<a id="oneTool" href="#comment" ><i class="fa fa-comment-o" aria-hidden="true"></i></a>
{% endblock %}

{% block main %}
	<div class="container">
		{% if alert == "commentSubmitted" %}
			{{ alerts.commentSubmitted() }}
		{% endif %}
	</div>
	<section class="container">
		{% if post.chapo %}
		<h2>Résumé</h2>
			<div id="postContent">
				<p>{{ post.chapo | nl2br }}</p>
			</div>
		{% endif %}
		{% if post.url is not empty %}
			<div id="section-preview" class="row text-center">
                <div class="col-sm-12 preview-item">
                    <a href="{{ post.url }}" target="_blank" class="preview-link" >
                        <div class="caption">
                            <div class="caption-content">
								<h3>Afficher le site</h3><br>
                                <i class="fa fa-external-link fa-3x"></i>
                            </div>
                        </div>
						<iframe id="SiteFrame"
							title="{{ post.title }}"
							width="100%"
							src="{{ post.url }}">
						</iframe>
                    </a>
                </div>
            </div>
			
		{% endif %}
		<h2>Description</h2>
		<div>
			<p>{{ post.content | nl2br }}</p>
		</div>
	</section>

	<section id="comment" class="container">
		<div id="commentAdd">
			{% if session.user %}
				{% if session.user.validated_email != "" %}
					<div class="row">
						<div class="col-lg-12 text-center">
							<h3>Laisser un commentaire</h3>
						</div>
					</div>
					<div class="row">
						<div class="col-lg-8 col-lg-offset-2">
							{# <form name="sentMessage" id="contactForm" novalidate> #}
							<form action="" method="post">
								<div class="row control-group">
									<div class="form-group col-xs-12 floating-label-form-group controls">
										<label>Commentaire</label>
										<textarea rows="3" class="form-control" placeholder="Ecrivez votre commentaire" id="comment" name="comment" required data-validation-required-message="Please enter a comment."></textarea>
										<p class="help-block text-danger"></p>
									</div>
								</div>
								<br>
								<div id="success"></div>
								<div class="row">
									<div class="form-group col-xs-12 text-center">
										<button type="submit" class="btn btn-success btn-lg">Envoyer</button>
									</div>
								</div>
							</form>
						</div>
					</div>
				{% else %}
					<div class="row">
						<div class="col text-center not-connected">
							<p>Vous devez valider votre adresse e-mail pour pouvoir laisser un commentaire.</p>
						</div>
					</div>
				{% endif %}
			{% else %}
				<div class="row">
					<div class="col text-center not-connected">
						<p>Vous devez être connecté pour pouvoir laisser un commentaire.</p>
						<a class="btn btn-sm btn-primary" href="/login" role="button">Se connecter</a>
					</div>
				</div>
			{% endif %}
		</div>

		{% if comments is not empty %}
			<div id="commentList" class="row">
				<div class="col-lg-12 text-center">
					<h3>Commentaires</h3>
					<hr class="star-primary">
				</div>
			</div>
			{% for comment in comments %}
				<div class="panel panel-default">
					<div class="panel-heading commentHeader">
						<small><strong>{{ comment.author.username }}</strong> le {{comment.frenchCreationDate }}</small>  
						{% if comment.author.identifier == (session.user.id) %}
							<a href="/comment/{{comment.identifier }}" ><i class="fa fa-edit" aria-hidden="true"></i></a>
						{% endif %}
					</div>
					<div class="panel-body">
						<p>{{ comment.comment | nl2br }}</p>
					</div>
				</div>
			{% endfor %}
            {{ utils.pagination(nbPage,"#commentList") }}
		{% endif %}
    </section>

{% endblock %}
